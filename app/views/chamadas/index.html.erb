<div class="page-header">
  <h1>Listando chamadas</h1>
</div>

<form action="/chamadas" method="get" class="busca">
  <div style="clear:both">
    <label>Login ou telefone:</label>
    <input type="text" class="form-control" name="q" value="<%= params[:q] %>">
    <br>
    <label>Status</label>
    <select class="form-control"  name="status" >
      <option selected value="">[Selecione]</option>
      <% @chamadas_total.map{|c|c.status_geral}.uniq.each do |status| %>
        <option value="<%= status %>" <% if params[:status] == status %>selected<% end %>><%= status %></option>
      <% end %>
    </select>
    <br>
    <label>Data de:</label>
    <input type="date" style="width: 180px" class="form-control" name="data_de" value="<%= params[:data_de] %>">
    <label>Data até:</label>
    <input type="date" style="width: 180px" class="form-control" name="data_ate" value="<%= params[:data_ate] %>">
    <br>
    <input type="submit" value="Buscar" class="btn btn-primary">
  </div>
</form>
<hr>
<div style="font-size: 20px">
  Total minutos: <strong><%= @chamadas_total.sum(:destino_duracao_cobrada) %></strong><br>
  Valor total: <strong>R$ <%= @chamadas_total.sum(:destino_preco).round(2) %></strong><br>
</div>
<hr>
<div class="table-responsive">
  <table class="table table-striped table-bordered table-hover" style="width: 1800px">
    <thead>
      <tr>
        <th>ID</th>
        <th>Status</th>
        <th>Data</th>
        <th>Login</th>
        <th>Destino</th>
        <th style="width: 280px">Destino duração</th>
        <th>Destino preço</th>
        <th>Áudio</th>
      </tr>
    </thead>

    <tbody>
      <%= content_tag_for(:tr, @chamadas) do |chamada| %>
        <td><%= chamada.chamada_voice_id %></td>
        <td><%= chamada.status_geral %></td>
        <td><%= chamada.data_criacao.strftime("%d/%m/%Y %H:%M:%S") %></td>
        <td><%= chamada.login %></td>
        <td><%= chamada.destino_numero %> - <%= chamada.destino_tipo %></td>
        <td>
          <%#= chamada.destino_duracao_cobrada_string %>
          <%= chamada.destino_duracao_cobrada.strftime("%H hora(s) %M minuto(s) e %S segundo(s)") %>
        </td>
        <td>R$ <%= chamada.destino_preco %></td>
        <td>
          <audio controls>
            <source src="<%= chamada.url_gravacao %>" >
          </audio>
        </td>
      <% end %>
    </tbody>
  </table>
  <div class="apple_pagination">
    <%= will_paginate(@chamadas, :container => false) %>
  </div>
</div>
